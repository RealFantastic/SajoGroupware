<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="CommuteRecord">

<!-- 	출근시간,퇴근시간 확인 -->
	<select id="toDayCommuteStatus" resultType="CommuteRecord" parameterType="String">
		SELECT 
			TO_CHAR(START_TIME, 'HH24:MI:SS') today_start_time
			,TO_CHAR(END_TIME, 'HH24:MI:SS') today_end_time
		FROM commute_record
		WHERE emp_no =#{id} 
			AND TO_CHAR(start_Time, 'YYYYMMDD') = TO_CHAR(sysdate, 'YYYYMMDD') 
	</select>

<!-- 출근시간 등록 -->
	<insert id="statusAtt">
		insert into COMMUTE_RECORD (RECORD_NO,EMP_NO,START_TIME,END_TIME)
		values(
		(select nvl(max(RECORD_NO),0)+1 from COMMUTE_RECORD)
		,'202230001'
		,systimestamp
		,null)
	</insert>
	
	
<!-- 퇴근시간 등록 -->
	<update id="statusLeave">
		UPDATE commute_record set end_time=SYSTIMESTAMP 
		where emp_no='202230001'
		and to_char(start_Time, 'YYYYMMDD') = to_char(sysdate, 'YYYYMMDD')
	</update>

<!-- 	나의 정보 -->
	<select id="commuteMyInfo" resultType="CommuteEmployee">
		SELECT EMP_NO
			, EMP_NAME
			, PHONE
			, (SELECT dept_name FROM department b WHERE b.dept_no = a.dept_no ) DEPT_NM
			, (SELECT job_name FROM job b WHERE b.job_no = a.job_no) JOB_NM
		FROM employee a where emp_no='202230001'
	</select>

	<select id="selectStatusAtt" parameterType="string" resultType="CommuteRecord">
		select * from 
		(select * from COMMUTE_RECORD order by start_time desc) 
		where emp_no = #{id} and rownum= 1
	</select>
	<select id="selectStatusLeave" parameterType="string" resultType="CommuteRecord">
		select * from 
		(select * from COMMUTE_RECORD order by end_time desc) 
		where emp_no = #{id} and rownum= 1
	</select>

	<select id="empCommuteList" resultType="CommuteEmployee">
		SELECT EMP_NO
			, EMP_NAME
			, PHONE
			, (SELECT dept_name FROM department b WHERE b.dept_no = a.dept_no ) DEPT_NM
			, (SELECT job_name FROM job b WHERE b.job_no = a.job_no) JOB_NM
		FROM employee a order by EMP_NO
	</select>
	
	
	
	<select id="empCommuteChange" resultType="CommuteRecord">
	
	</select>
</mapper>
