<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Holiday">

<!-- 	페이지 띄우기 -->
	<select id="holidayEmpList" resultType="HolidayEmployee">
		SELECT EMP_NO
			, EMP_NAME
			, PHONE
			,(SELECT dept_name FROM department b WHERE b.dept_no=a.dept_no) DEPT_NM
			,(SELECT job_name FROM job b WHERE b.job_no=a.job_no) JOB_NM
			,(SELECT left_count FROM employee_holiday b WHERE b.emp_no=a.emp_no) LEFT_COUNT
		FROM employee a order by EMP_NO
	</select>



<!-- 개인 연차내역 리스트 띄우기 TODO-->
	<select id="holidayMystatus" parameterType="hashmap" >
		select
			to_char(req_date, 'YYYY-MM_DD') REQ_DATE<!-- 연차 신청일 -->
			, to_char(hd_start,'YYYY-MM-DD') HD_START<!-- 연차 시작일 -->
			, to_char(hd_end, 'YYYY-MM-DD') HD_END<!-- 연차 종료일 --> 
			, hd_count HD_COUNT<!-- 사용연차(일수) --> 
			, left_count LEFT_COUNT<!--잔여연차(일수) -->
			,ea_no HD_RESON<!--비고(문서번호) --> 
		from holiday_history
		where emp_no=#{id} and to_char(hd_start,'YYYY')='#{birthYear}'
	</select>



















	<insert id="insertHoliday" parameterType="Holiday">
		INSERT INTO HOLIDAY_HISTORY 
		VALUES
		(
		(SELECT NVL(MAX(HD_NO),0)+1 FROM HOLIDAY_HISTORY)
		, #{emp_no}, default, #{hd_start}, #{hd_end}, #{hd_code}
		, #{hd_count}, #{hd_reason}, #{ea_no}
		)
	</insert>
	<!-- 선택한 결재문서의 내용  -->
	<select id="selectHoliday" parameterType="string" resultType="Holiday">
		SELECT * FROM HOLIDAY_HISTORY WHERE EA_NO=#{ea_no}
	</select>
	
	<!-- 휴가신청기록 삭제 -->
	<delete id="deleteHoliday" parameterType="string">
		DELETE FROM HOLIDAY_HISTORY WHERE EA_NO = #{ea_no}
	</delete>
</mapper>
